{
  "id": "case-03",
  "number": 3,
  "title": "A Evid√™ncia Perdida",
  "subtitle": "16 fotos de cena de crime desaparecem sem deixar rastro",
  "brief": {
    "narrative": "A equipe de per√≠cia enviou 47 fotos de cena de crime de um triplo homic√≠dio na 5¬™ Avenida. O sistema de gest√£o de evid√™ncias confirmou todos os 47 uploads. Mas quando o Detetive Latency foi revisar as evid√™ncias esta manh√£, apenas 31 fotos est√£o no sistema. 16 fotos sumiram ‚Äî incluindo as fotos cr√≠ticas da an√°lise de padr√£o de sangue. O servidor l√≠der caiu ontem √† noite √†s 3 da manh√£, e o seguidor foi promovido para assumir. Algo aconteceu no intervalo. Este √© um caso de homic√≠dio, Detetive. N√£o podemos perder evid√™ncias.",
    "symptoms": [
      "47 fotos foram enviadas e confirmadas pelo banco de dados l√≠der",
      "O servidor l√≠der caiu √†s 3:00 AM devido a uma queda de energia",
      "O seguidor foi automaticamente promovido a novo l√≠der √†s 3:01 AM",
      "O novo l√≠der (antigo seguidor) possui apenas 31 das 47 fotos",
      "16 fotos foram permanentemente perdidas ‚Äî n√£o est√£o em nenhum servidor"
    ],
    "objective": "Determinar por que 16 fotos foram perdidas durante o failover e recomendar como prevenir perda de dados em futuras falhas do l√≠der."
  },
  "diagram": {
    "nodes": [
      {
        "id": "forensics",
        "type": "client",
        "label": "Forensics Team",
        "status": "healthy",
        "position": { "x": 100, "y": 50 },
        "inspectable": true,
        "inspectData": {
          "title": "Terminal de Upload da Per√≠cia",
          "logs": [
            "[22:00:00] INFO: Uploading 47 evidence photos...",
            "[22:00:15] INFO: Photo 1/47 ‚Äî acknowledged by leader",
            "[22:01:30] INFO: Photo 31/47 ‚Äî acknowledged by leader",
            "[22:01:45] INFO: Photo 32/47 ‚Äî acknowledged by leader",
            "[22:03:00] INFO: Photo 47/47 ‚Äî acknowledged by leader",
            "[22:03:01] INFO: All 47 photos uploaded successfully ‚úì"
          ],
          "data": {
            "Total Uploaded": "47 photos",
            "All Acknowledged": "Yes",
            "Upload Completed": "22:03:01"
          },
          "status": "Todas as 47 fotos foram enviadas e confirmadas pelo l√≠der."
        }
      },
      {
        "id": "db-leader",
        "type": "database",
        "label": "Leader DB (crashed)",
        "status": "failed",
        "position": { "x": 400, "y": 50 },
        "inspectable": true,
        "inspectData": {
          "title": "Antigo Banco de Dados L√≠der",
          "logs": [
            "[22:00:15] INFO: Received photo 1, writing to disk, replicating async",
            "[22:01:30] INFO: Received photo 31, writing to disk, replicating async",
            "[22:01:45] INFO: Received photo 32, writing to disk ‚Äî replication QUEUED",
            "[22:03:00] INFO: Received photo 47, writing to disk ‚Äî replication QUEUED",
            "[22:03:01] INFO: All 47 photos stored locally",
            "[03:00:00] FATAL: Power failure detected",
            "[03:00:00] FATAL: Server shutting down ‚Äî 16 photos not yet replicated"
          ],
          "data": {
            "Status": "OFFLINE (power failure)",
            "Photos Stored Locally": "47",
            "Photos Replicated to Follower": "31",
            "Photos NOT Replicated": "16 (photos 32-47)",
            "Replication Mode": "ASYNCHRONOUS"
          },
          "status": "Caiu antes de replicar as fotos 32-47 para o seguidor."
        }
      },
      {
        "id": "db-follower",
        "type": "database",
        "label": "Follower ‚Üí New Leader",
        "status": "degraded",
        "position": { "x": 400, "y": 250 },
        "inspectable": true,
        "inspectData": {
          "title": "Seguidor (Promovido a L√≠der)",
          "logs": [
            "[22:00:16] INFO: Replicated photo 1 from leader",
            "[22:01:31] INFO: Replicated photo 31 from leader",
            "[22:01:32] INFO: Waiting for more replication events...",
            "[03:00:01] WARN: Leader heartbeat lost",
            "[03:00:01] INFO: Initiating automatic failover",
            "[03:00:02] INFO: Promoted to LEADER role",
            "[03:00:02] WARN: Last replicated photo: #31. Photos 32-47 never received."
          ],
          "data": {
            "Status": "ONLINE (promoted to leader)",
            "Photos Available": "31 of 47",
            "Missing Photos": "16 (photos 32-47)",
            "Replication Mode Was": "ASYNCHRONOUS",
            "Data Loss": "YES ‚Äî 16 items permanently lost"
          },
          "status": "Promovido a l√≠der, mas faltam 16 fotos que nunca foram replicadas."
        }
      },
      {
        "id": "detective",
        "type": "client",
        "label": "Det. Latency",
        "status": "degraded",
        "position": { "x": 650, "y": 250 },
        "inspectable": true,
        "inspectData": {
          "title": "Terminal do Detetive Latency",
          "logs": [
            "[08:00:00] INFO: Querying evidence for Case #5AVE-2024",
            "[08:00:01] INFO: Connected to new leader (former follower)",
            "[08:00:01] WARN: Only 31 photos found. Expected 47.",
            "[08:00:02] ERROR: Missing photos include blood spatter analysis shots"
          ],
          "data": {
            "Expected Photos": "47",
            "Available Photos": "31",
            "Missing": "16 critical evidence photos"
          },
          "status": "Evid√™ncias incompletas. 16 fotos perdidas durante o failover."
        }
      }
    ],
    "edges": [
      { "id": "e-forensics-leader", "source": "forensics", "target": "db-leader", "label": "upload (47 photos)", "animated": false, "style": "normal" },
      { "id": "e-leader-follower", "source": "db-leader", "target": "db-follower", "label": "async replication (31 of 47)", "animated": false, "style": "slow" },
      { "id": "e-follower-detective", "source": "db-follower", "target": "detective", "label": "query (31 photos)", "animated": true, "style": "normal" }
    ]
  },
  "diagnosis": {
    "rootCause": {
      "question": "Por que 16 das 47 fotos foram perdidas?",
      "options": [
        {
          "id": "rc-1",
          "text": "O upload da equipe de per√≠cia foi interrompido antes de todas as fotos serem enviadas",
          "correct": false,
          "feedback": "Os logs de upload mostram claramente que todas as 47 fotos foram enviadas e confirmadas pelo l√≠der. Os uploads foram conclu√≠dos com sucesso √†s 22:03."
        },
        {
          "id": "rc-2",
          "text": "O banco de dados seguidor rejeitou as fotos por falta de espa√ßo de armazenamento",
          "correct": false,
          "feedback": "O seguidor armazenou com sucesso as 31 fotos que recebeu. O problema √© que 16 fotos nunca foram enviadas para ele ‚Äî ainda estavam enfileiradas para replica√ß√£o no l√≠der quando ele caiu."
        },
        {
          "id": "rc-3",
          "text": "A replica√ß√£o ass√≠ncrona permitiu que o l√≠der confirmasse escritas antes de replic√°-las ‚Äî quando o l√≠der caiu, dados n√£o replicados foram perdidos",
          "correct": true,
          "feedback": "Correto! Com replica√ß√£o ass√≠ncrona, o l√≠der confirma uma escrita assim que ela √© armazenada localmente, sem esperar o seguidor confirmar. As fotos 32-47 foram armazenadas no l√≠der e confirmadas ao cliente, mas ainda n√£o tinham sido enviadas ao seguidor. Quando o l√≠der caiu, essas 16 fotos existiam apenas no servidor que falhou ‚Äî perdidas para sempre."
        },
        {
          "id": "rc-4",
          "text": "Uma parti√ß√£o de rede entre l√≠der e seguidor bloqueou a replica√ß√£o",
          "correct": false,
          "feedback": "Os logs de replica√ß√£o mostram que as fotos 1-31 foram replicadas com sucesso. As restantes estavam enfileiradas ‚Äî o l√≠der simplesmente n√£o as enviou antes de cair. Esta √© a natureza da replica√ß√£o ass√≠ncrona, n√£o um problema de rede."
        }
      ]
    },
    "fix": {
      "question": "Como o sistema de evid√™ncias deve ser alterado para prevenir perda de dados durante o failover?",
      "options": [
        {
          "id": "fix-1",
          "text": "Usar replica√ß√£o s√≠ncrona para dados cr√≠ticos ‚Äî o l√≠der espera a confirma√ß√£o do seguidor antes de confirmar a escrita",
          "correct": true,
          "feedback": "Correto! Com replica√ß√£o s√≠ncrona, o l√≠der n√£o confirma uma escrita at√© que pelo menos um seguidor confirme ter recebido os dados. Isso garante que, se o l√≠der cair, o seguidor tenha todos os dados confirmados. O custo √© maior lat√™ncia de escrita, mas para dados cr√≠ticos de evid√™ncia, durabilidade √© mais importante que velocidade."
        },
        {
          "id": "fix-2",
          "text": "Adicionar um segundo seguidor para aumentar as chances de replica√ß√£o",
          "correct": false,
          "feedback": "Se ambos os seguidores usam replica√ß√£o ass√≠ncrona, um segundo seguidor n√£o garante que os dados sejam replicados antes de um crash. Voc√™ pode ter dois seguidores sem os mesmos dados. A solu√ß√£o √© replica√ß√£o s√≠ncrona, n√£o mais seguidores ass√≠ncronos."
        },
        {
          "id": "fix-3",
          "text": "Aumentar a velocidade de replica√ß√£o para que aconte√ßa mais r√°pido",
          "correct": false,
          "feedback": "Replica√ß√£o ass√≠ncrona mais r√°pida reduz a janela de potencial perda de dados mas n√£o a elimina. Mesmo com 1 segundo de atraso, se o l√≠der cair no momento errado, voc√™ perde dados. Para dados cr√≠ticos, voc√™ precisa de uma garantia ‚Äî √© isso que a replica√ß√£o s√≠ncrona oferece."
        },
        {
          "id": "fix-4",
          "text": "N√£o permitir failover autom√°tico ‚Äî esperar o l√≠der voltar ao ar",
          "correct": false,
          "feedback": "Isso recuperaria os dados (se o disco sobreviveu), mas ao custo da disponibilidade. O sistema ficaria offline at√© o l√≠der ser reparado, o que pode levar horas ou dias. A melhor abordagem √© replica√ß√£o s√≠ncrona, que garante que o seguidor sempre tenha os dados E possa assumir imediatamente."
        }
      ]
    }
  },
  "conceptId": "sync-vs-async-replication",
  "badge": {
    "name": "Guardi√£o dos Dados",
    "icon": "üîí"
  }
}
