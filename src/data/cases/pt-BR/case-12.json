{
  "id": "case-12",
  "number": 12,
  "title": "O Limite Vertical",
  "subtitle": "O servidor de an√°lise criminal atinge o teto do hardware",
  "brief": {
    "narrative": "A Divis√£o de An√°lise Criminal de Distributia est√° em crise. Seu servidor principal de an√°lise ‚Äî respons√°vel por processar dados de padr√µes criminais de todos os distritos ‚Äî foi atualizado com o hardware mais potente que o dinheiro pode comprar: 128 cores, 1TB de RAM, tudo do melhor. Mas ainda n√£o √© suficiente. Os tempos de resposta para consultas de tend√™ncias criminais dispararam para 45 segundos, e o processamento noturno em lote dos relat√≥rios de incidentes agora leva 14 horas em vez de 3. O fornecedor diz que n√£o existe m√°quina maior dispon√≠vel. O Chefe Partition quer saber por que jogar mais hardware no problema n√£o est√° funcionando e qual √© a solu√ß√£o real, Detetive.",
    "symptoms": [
      "Consultas de an√°lise criminal levam mais de 45 segundos apesar do hardware no limite m√°ximo",
      "Utiliza√ß√£o de CPU fixada em 98% durante hor√°rios de pico",
      "Processamento noturno em lote cresceu de 3 horas para 14 horas",
      "Fornecedor de hardware confirma que n√£o h√° mais upgrades verticais dispon√≠veis"
    ],
    "objective": "Identificar por que a abordagem de servidor √∫nico atingiu seu limite e recomendar uma arquitetura que possa escalar al√©m de uma m√°quina."
  },
  "diagram": {
    "nodes": [
      {
        "id": "analytics-server",
        "type": "server",
        "label": "Analytics Server",
        "status": "degraded",
        "position": { "x": 350, "y": 50 },
        "inspectable": true,
        "inspectData": {
          "title": "Servidor de An√°lise Criminal",
          "logs": [
            "[08:15:01] WARN: CPU utilization at 98%",
            "[08:15:02] WARN: Memory usage at 94% (961GB/1024GB)",
            "[08:15:10] WARN: Query queue depth: 847 pending",
            "[08:15:22] ERROR: Query timeout for district-7 trend analysis (>45s)",
            "[08:15:30] INFO: No horizontal scaling configured ‚Äî single node only"
          ],
          "data": {
            "CPU Cores": "128 (all saturated)",
            "RAM": "1024 GB (94% used)",
            "Status": "MAXED OUT",
            "Pending Queries": "847",
            "Avg Query Time": "45.2s",
            "Max Vertical Upgrade": "Already at maximum"
          },
          "status": "Hardware do servidor totalmente no limite. Nenhuma escalabilidade vertical adicional √© poss√≠vel."
        }
      },
      {
        "id": "district-api",
        "type": "server",
        "label": "District API Gateway",
        "status": "degraded",
        "position": { "x": 350, "y": 220 },
        "inspectable": true,
        "inspectData": {
          "title": "Gateway de API Distrital",
          "logs": [
            "[08:15:05] WARN: Upstream analytics server response slow",
            "[08:15:12] WARN: 312 requests queued waiting for analytics",
            "[08:15:25] ERROR: Client timeouts increasing"
          ],
          "data": {
            "Status": "SLOW",
            "Queued Requests": "312",
            "Upstream Targets": "1 (analytics-server only)"
          },
          "status": "Apenas um destino upstream de an√°lise. N√£o √© poss√≠vel distribuir a carga."
        }
      },
      {
        "id": "precinct-dashboard",
        "type": "client",
        "label": "Precinct Dashboards",
        "status": "degraded",
        "position": { "x": 100, "y": 380 },
        "inspectable": true,
        "inspectData": {
          "title": "Dashboards das Delegacias",
          "logs": [
            "[08:16:00] WARN: Dashboard loading time > 40s",
            "[08:16:15] ERROR: Crime trend widget timed out"
          ],
          "data": {
            "Active Users": "85",
            "Avg Load Time": "42s",
            "Timeout Rate": "34%"
          },
          "status": "Dashboards extremamente lentos devido ao gargalo no servidor de an√°lise."
        }
      },
      {
        "id": "batch-processor",
        "type": "client",
        "label": "Batch Processor",
        "status": "degraded",
        "position": { "x": 600, "y": 380 },
        "inspectable": true,
        "inspectData": {
          "title": "Processador de Lotes Noturno",
          "logs": [
            "[00:00:01] INFO: Nightly batch started",
            "[14:12:33] WARN: Batch still running ‚Äî expected completion in 3h",
            "[14:12:34] WARN: Competing with daytime queries for CPU"
          ],
          "data": {
            "Batch Duration": "14h 12m (target: 3h)",
            "Records Processed": "12.4M",
            "Status": "RUNNING BEHIND"
          },
          "status": "Job em lote competindo por recursos no servidor √∫nico."
        }
      }
    ],
    "edges": [
      { "id": "e-api-analytics", "source": "district-api", "target": "analytics-server", "label": "queries", "animated": true, "style": "slow" },
      { "id": "e-dashboard-api", "source": "precinct-dashboard", "target": "district-api", "label": "requests", "animated": true, "style": "slow" },
      { "id": "e-batch-analytics", "source": "batch-processor", "target": "analytics-server", "label": "batch jobs", "animated": true, "style": "slow" }
    ]
  },
  "diagnosis": {
    "rootCause": {
      "question": "Qual √© a causa raiz do problema de desempenho do servidor de an√°lise?",
      "options": [
        {
          "id": "rc-1",
          "text": "O hardware do servidor est√° com defeito e n√£o est√° funcionando conforme as especifica√ß√µes",
          "correct": false,
          "feedback": "O hardware est√° funcionando corretamente ‚Äî ele simplesmente est√° na capacidade m√°xima. O servidor est√° usando todos os 128 cores e quase todo o 1TB de RAM conforme projetado."
        },
        {
          "id": "rc-2",
          "text": "O sistema atingiu o limite de escalabilidade vertical ‚Äî uma √∫nica m√°quina n√£o pode mais ser atualizada para atender √† demanda",
          "correct": true,
          "feedback": "Correto! A escalabilidade vertical (adicionar mais CPU/RAM a uma m√°quina) tem um teto r√≠gido. Quando voc√™ esgotou o maior servidor dispon√≠vel, o √∫nico caminho adiante √© a escalabilidade horizontal ‚Äî distribuir a carga de trabalho entre m√∫ltiplas m√°quinas."
        },
        {
          "id": "rc-3",
          "text": "As consultas ao banco de dados s√£o mal otimizadas e precisam de ajuste de √≠ndices",
          "correct": false,
          "feedback": "Embora a otimiza√ß√£o de consultas possa ajudar, o problema fundamental √© que todo o trabalho est√° concentrado em uma √∫nica m√°quina que j√° est√° no limite do hardware. Mesmo consultas perfeitamente otimizadas ainda saturariam um servidor nessa escala."
        },
        {
          "id": "rc-4",
          "text": "O processador de lotes est√° executando durante o hor√°rio de pico e deveria ser reagendado",
          "correct": false,
          "feedback": "Reagendar o job em lote pode proporcionar al√≠vio tempor√°rio, mas o problema central √© que uma m√°quina n√£o consegue lidar com a carga total. O job em lote cresceu de 3h para 14h ‚Äî ele agora se sobrep√µe ao tr√°fego diurno independentemente de quando come√ßa."
        }
      ]
    },
    "fix": {
      "question": "Qual √© a melhor solu√ß√£o para escalar o sistema de an√°lise al√©m dos seus limites atuais?",
      "options": [
        {
          "id": "fix-1",
          "text": "Implementar escalabilidade horizontal ‚Äî adicionar m√∫ltiplos servidores de an√°lise atr√°s de um load balancer para distribuir a carga de trabalho",
          "correct": true,
          "feedback": "Correto! A escalabilidade horizontal (scaling out) adiciona mais m√°quinas para compartilhar a carga. Um load balancer distribui consultas entre m√∫ltiplos servidores de an√°lise, e o processamento em lote pode rodar em n√≥s dedicados. Diferente da escalabilidade vertical, a horizontal n√£o tem teto r√≠gido ‚Äî voc√™ pode continuar adicionando m√°quinas."
        },
        {
          "id": "fix-2",
          "text": "Esperar pela pr√≥xima gera√ß√£o de hardware de servidor com mais cores e RAM",
          "correct": false,
          "feedback": "Isso √© apenas empurrar o problema para frente. Mesmo que uma m√°quina maior fique dispon√≠vel, a demanda eventualmente vai super√°-la tamb√©m. A escalabilidade horizontal oferece um caminho sustent√°vel que n√£o depende de gera√ß√µes de hardware."
        },
        {
          "id": "fix-3",
          "text": "Reduzir a quantidade de dados criminais retidos para diminuir a carga de processamento",
          "correct": false,
          "feedback": "Deletar dados para caber dentro dos limites do hardware √© uma solu√ß√£o ruim. A divis√£o de an√°lise precisa de dados hist√≥ricos para an√°lise de tend√™ncias. A arquitetura deve escalar para atender √†s necessidades dos dados, n√£o o contr√°rio."
        },
        {
          "id": "fix-4",
          "text": "Migrar para uma linguagem de programa√ß√£o mais r√°pida para extrair mais desempenho do mesmo hardware",
          "correct": false,
          "feedback": "Mesmo um programa perfeitamente otimizado s√≥ pode usar 100% dos recursos de uma m√°quina ‚Äî que √© exatamente onde j√° estamos. O gargalo √© a arquitetura de m√°quina √∫nica, n√£o a efici√™ncia do software."
        }
      ]
    }
  },
  "conceptId": "horizontal-scaling",
  "badge": {
    "name": "Arquiteto de Escala",
    "icon": "üìê"
  }
}
