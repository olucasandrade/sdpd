{
  "id": "case-17",
  "number": 17,
  "title": "O Card√°pio Vencido",
  "subtitle": "CDN serve lista de Mais Procurados desatualizada horas ap√≥s atualiza√ß√£o",
  "brief": {
    "narrative": "Um fugitivo perigoso foi capturado √†s 6 da manh√£, e a equipe de detetives imediatamente atualizou a lista de Mais Procurados no site p√∫blico da Pol√≠cia de Distributia. Mas j√° √© meio-dia e cidad√£os pela cidade inteira ainda est√£o vendo a lista antiga com o fugitivo capturado. Den√∫ncias est√£o chegando aos montes sobre algu√©m que j√° est√° preso, desperdi√ßando tempo dos investigadores. O servidor de origem tem a lista correta, mas os n√≥s de borda do CDN espalhados por Distributia ainda est√£o servindo a vers√£o em cache de ontem. O header cache-control do CDN est√° configurado como max-age=86400 (24 horas) sem mecanismo de purge. O Chefe Partition precisa que o p√∫blico veja informa√ß√µes precisas AGORA, Detetive.",
    "symptoms": [
      "P√°gina de Mais Procurados mostra fugitivo capturado 6 horas ap√≥s remo√ß√£o da origem",
      "N√≥s de borda do CDN servindo vers√£o em cache do dia anterior",
      "Servidor de origem tem o conte√∫do atualizado correto",
      "Den√∫ncias falsas chegando em massa sobre suspeito j√° capturado"
    ],
    "objective": "Identificar por que o CDN est√° servindo conte√∫do desatualizado e recomendar uma estrat√©gia para atualiza√ß√µes oportunas do cache do CDN."
  },
  "diagram": {
    "nodes": [
      {
        "id": "origin-server",
        "type": "server",
        "label": "Origin Server",
        "status": "healthy",
        "position": { "x": 350, "y": 50 },
        "inspectable": true,
        "inspectData": {
          "title": "Servidor Web de Origem",
          "logs": [
            "[06:02:00] INFO: Most Wanted list updated ‚Äî fugitive #MW-2241 removed",
            "[06:02:01] INFO: New content deployed successfully",
            "[06:02:02] WARN: No CDN purge/invalidation triggered",
            "[12:00:00] INFO: Origin serving correct updated list"
          ],
          "data": {
            "Content Version": "v2024-1547 (updated 06:02 today)",
            "Fugitive #MW-2241": "REMOVED (captured)",
            "CDN Purge API": "Not integrated",
            "Cache-Control Header": "max-age=86400 (24 hours)"
          },
          "status": "Conte√∫do de origem est√° correto, mas o CDN n√£o foi notificado da atualiza√ß√£o."
        }
      },
      {
        "id": "cdn-edge-north",
        "type": "server",
        "label": "CDN Edge (North)",
        "status": "degraded",
        "position": { "x": 100, "y": 220 },
        "inspectable": true,
        "inspectData": {
          "title": "N√≥ de Borda CDN ‚Äî Distrito Norte",
          "logs": [
            "[Yesterday 08:00] INFO: Cached Most Wanted page (TTL: 24h)",
            "[Today 12:00] INFO: Serving cached version ‚Äî TTL remaining: 20h",
            "[Today 12:00] INFO: No purge request received"
          ],
          "data": {
            "Cached Version": "v2024-1546 (STALE ‚Äî yesterday)",
            "Fugitive #MW-2241": "STILL SHOWING (should be removed)",
            "Cache TTL Remaining": "20 hours",
            "Purge Endpoint": "Available but never called"
          },
          "status": "Servindo conte√∫do desatualizado. Cache n√£o ser√° atualizado por mais 20 horas."
        }
      },
      {
        "id": "cdn-edge-south",
        "type": "server",
        "label": "CDN Edge (South)",
        "status": "degraded",
        "position": { "x": 600, "y": 220 },
        "inspectable": true,
        "inspectData": {
          "title": "N√≥ de Borda CDN ‚Äî Distrito Sul",
          "logs": [
            "[Yesterday 09:30] INFO: Cached Most Wanted page (TTL: 24h)",
            "[Today 12:00] INFO: Serving cached version ‚Äî TTL remaining: 21.5h"
          ],
          "data": {
            "Cached Version": "v2024-1546 (STALE ‚Äî yesterday)",
            "Fugitive #MW-2241": "STILL SHOWING",
            "Cache TTL Remaining": "21.5 hours"
          },
          "status": "Servindo conte√∫do desatualizado sem mecanismo de invalida√ß√£o."
        }
      },
      {
        "id": "citizens",
        "type": "client",
        "label": "Citizens",
        "status": "degraded",
        "position": { "x": 350, "y": 380 },
        "inspectable": true,
        "inspectData": {
          "title": "Cidad√£os",
          "logs": [
            "[12:00:00] INFO: Citizen reports seeing captured fugitive on Most Wanted",
            "[12:05:00] INFO: 47 false tips received for fugitive #MW-2241"
          ],
          "data": {
            "Tips for Captured Fugitive": "47 (all wasted)",
            "Content Seen": "Yesterday's stale version",
            "Served By": "CDN edge nodes (not origin)"
          },
          "status": "Cidad√£os vendo lista de Mais Procurados desatualizada do cache do CDN."
        }
      }
    ],
    "edges": [
      { "id": "e-cdn-north-origin", "source": "cdn-edge-north", "target": "origin-server", "label": "no revalidation", "animated": false, "style": "normal" },
      { "id": "e-cdn-south-origin", "source": "cdn-edge-south", "target": "origin-server", "label": "no revalidation", "animated": false, "style": "normal" },
      { "id": "e-citizens-north", "source": "citizens", "target": "cdn-edge-north", "label": "stale content", "animated": true, "style": "slow" },
      { "id": "e-citizens-south", "source": "citizens", "target": "cdn-edge-south", "label": "stale content", "animated": true, "style": "slow" }
    ]
  },
  "diagnosis": {
    "rootCause": {
      "question": "Qual √© a causa raiz do CDN servir conte√∫do desatualizado?",
      "options": [
        {
          "id": "rc-1",
          "text": "O servidor de origem falhou em atualizar a lista de Mais Procurados corretamente",
          "correct": false,
          "feedback": "O servidor de origem atualizou corretamente √†s 6 da manh√£. Acessar a origem diretamente mostra a lista correta. O problema √© que os n√≥s de borda do CDN t√™m sua pr√≥pria c√≥pia em cache e n√£o sabem que a origem mudou."
        },
        {
          "id": "rc-2",
          "text": "O cache-control do CDN est√° configurado para 24 horas sem mecanismo de purge ou invalida√ß√£o ‚Äî os n√≥s de borda n√£o v√£o buscar conte√∫do novo at√© o TTL expirar",
          "correct": true,
          "feedback": "Correto! O CDN faz cache do conte√∫do por 24 horas (max-age=86400) e n√£o tem integra√ß√£o de purge. Quando o conte√∫do muda na origem, n√£o h√° como avisar os n√≥s de borda do CDN para descartar suas c√≥pias em cache. Esta √© uma armadilha comum de cache de CDN ‚Äî TTLs longos precisam ser combinados com APIs de purge/invalida√ß√£o."
        },
        {
          "id": "rc-3",
          "text": "Os n√≥s de borda do CDN est√£o com um bug e n√£o est√£o respeitando os headers de cache",
          "correct": false,
          "feedback": "O CDN est√° funcionando exatamente como configurado ‚Äî est√° respeitando o TTL de 24 horas perfeitamente. O problema √© que 24 horas √© muito tempo para conte√∫do que muda frequentemente quando n√£o h√° mecanismo de purge."
        },
        {
          "id": "rc-4",
          "text": "Os navegadores dos cidad√£os est√£o fazendo cache da p√°gina antiga localmente",
          "correct": false,
          "feedback": "Mesmo que os cidad√£os fa√ßam hard-refresh nos navegadores, os n√≥s de borda do CDN v√£o servir a vers√£o desatualizada. O problema est√° na camada do CDN, n√£o na camada do navegador."
        }
      ]
    },
    "fix": {
      "question": "Qual √© a melhor solu√ß√£o para garantir que o conte√∫do do CDN se mantenha atualizado quando a origem muda?",
      "options": [
        {
          "id": "fix-1",
          "text": "Configurar o TTL do cache do CDN para zero para que sempre busque da origem",
          "correct": false,
          "feedback": "Um TTL zero anula todo o prop√≥sito de um CDN. Cada requisi√ß√£o atingiria o servidor de origem, eliminando os benef√≠cios de desempenho e escalabilidade. O objetivo √© fazer cache agressivamente mas invalidar de forma inteligente."
        },
        {
          "id": "fix-2",
          "text": "Integrar o purge de cache do CDN ao fluxo de atualiza√ß√£o de conte√∫do ‚Äî invalidar automaticamente o cache do CDN quando o conte√∫do muda na origem",
          "correct": true,
          "feedback": "Correto! APIs de purge/invalida√ß√£o do CDN permitem limpar proativamente conte√∫do em cache quando voc√™ sabe que ele mudou. Combinado com URLs versionadas ou TTLs mais curtos para conte√∫do din√¢mico, isso oferece o desempenho do cache do CDN com a atualidade do conte√∫do servido pela origem."
        },
        {
          "id": "fix-3",
          "text": "Reduzir o TTL do CDN de 24 horas para 5 minutos",
          "correct": false,
          "feedback": "Um TTL de 5 minutos reduz a desatualiza√ß√£o, mas aumenta significativamente a carga na origem (cada n√≥ de borda busca novamente a cada 5 minutos). Para a p√°gina de Mais Procurados, 5 minutos de dados desatualizados ainda pode ser problem√°tico. Uma abordagem de purge na atualiza√ß√£o oferece tanto atualidade quanto efici√™ncia."
        },
        {
          "id": "fix-4",
          "text": "Ignorar o CDN completamente para a p√°gina de Mais Procurados e servir diretamente da origem",
          "correct": false,
          "feedback": "Remover o cache do CDN para p√°ginas populares significa que o servidor de origem lida com todo o tr√°fego diretamente, perdendo os benef√≠cios de distribui√ß√£o geogr√°fica e desempenho do CDN. √â melhor usar o CDN com uma estrat√©gia de invalida√ß√£o adequada."
        }
      ]
    }
  },
  "conceptId": "cdn-caching",
  "badge": {
    "name": "Comandante de CDN",
    "icon": "üåê"
  }
}
