{
  "id": "case-23",
  "number": 23,
  "title": "A Identifica√ß√£o Inconsistente",
  "subtitle": "Duas delegacias veem vers√µes diferentes do mesmo suspeito ao mesmo tempo",
  "brief": {
    "narrative": "Distributia tem um grande problema. A Delegacia Norte acabou de liberar o suspeito Viktor Reznikov porque o sistema deles mostra seu status como 'Inocentado ‚Äî sem acusa√ß√µes'. Enquanto isso, a Delegacia Sul est√° ativamente preparando um mandado de pris√£o para o mesmo Viktor Reznikov, cujo status no sistema deles mostra 'Suspeito Principal ‚Äî armado e perigoso'. Mesma pessoa, mesmo momento, dois perfis completamente diferentes. O banco de dados de suspeitos foi recentemente distribu√≠do entre dois data centers para disponibilidade, mas parece que as duas c√≥pias n√£o contam a mesma hist√≥ria. O Chefe Partition precisa entender como duas delegacias podem ver dados contradit√≥rios simultaneamente.",
    "symptoms": [
      "Delegacia Norte mostra Viktor Reznikov como 'Inocentado' enquanto Delegacia Sul o mostra como 'Suspeito Principal'",
      "O perfil do suspeito foi atualizado 10 minutos atr√°s no data center Sul",
      "A atualiza√ß√£o ainda n√£o propagou para o data center Norte",
      "Ambas as delegacias podem ler e escrever no banco de dados sem erros"
    ],
    "objective": "Entender por que duas delegacias veem dados diferentes e recomendar uma estrat√©gia de consist√™ncia que equilibre disponibilidade e corre√ß√£o."
  },
  "diagram": {
    "nodes": [
      {
        "id": "north-precinct",
        "type": "client",
        "label": "North Precinct",
        "status": "healthy",
        "position": { "x": 100, "y": 50 },
        "inspectable": true,
        "inspectData": {
          "title": "Terminal da Delegacia Norte",
          "logs": [
            "[16:30:00] INFO: Query suspect 'Reznikov' ‚Äî reading from DC-North",
            "[16:30:00] INFO: Result: Status='Cleared', Last Updated='15:50:00'",
            "[16:30:05] INFO: Officer released suspect based on 'Cleared' status"
          ],
          "data": {
            "Status": "ONLINE",
            "Data Center": "DC-North",
            "Read Consistency": "Local (eventual)",
            "Reznikov Status Seen": "Cleared ‚Äî no charges"
          },
          "status": "Lendo dados desatualizados da r√©plica local DC-North. N√£o v√™ a atualiza√ß√£o feita no DC-South."
        }
      },
      {
        "id": "dc-north",
        "type": "database",
        "label": "DC-North (Replica)",
        "status": "degraded",
        "position": { "x": 100, "y": 230 },
        "inspectable": true,
        "inspectData": {
          "title": "Data Center Norte ‚Äî R√©plica do Banco de Dados",
          "logs": [
            "[15:50:00] INFO: Reznikov record: Status='Cleared'",
            "[16:20:00] WARN: Replication lag from DC-South: 10 minutes",
            "[16:30:00] WARN: Still awaiting replication of Reznikov update from DC-South"
          ],
          "data": {
            "Status": "ONLINE (stale data)",
            "Replication Mode": "Async from DC-South",
            "Replication Lag": "10+ minutes",
            "Reznikov Record Version": "v3 (outdated)",
            "Consistency Level": "Eventual"
          },
          "status": "Servindo leituras de dados locais desatualizados. Replica√ß√£o ass√≠ncrona n√£o entregou a √∫ltima atualiza√ß√£o do Reznikov."
        }
      },
      {
        "id": "south-precinct",
        "type": "client",
        "label": "South Precinct",
        "status": "healthy",
        "position": { "x": 600, "y": 50 },
        "inspectable": true,
        "inspectData": {
          "title": "Terminal da Delegacia Sul",
          "logs": [
            "[16:20:00] INFO: Updated suspect 'Reznikov' status to 'Prime Suspect'",
            "[16:30:00] INFO: Query suspect 'Reznikov' ‚Äî reading from DC-South",
            "[16:30:00] INFO: Result: Status='Prime Suspect', Last Updated='16:20:00'",
            "[16:30:10] INFO: Preparing arrest warrant for Reznikov"
          ],
          "data": {
            "Status": "ONLINE",
            "Data Center": "DC-South",
            "Read Consistency": "Local (eventual)",
            "Reznikov Status Seen": "Prime Suspect ‚Äî armed and dangerous"
          },
          "status": "Lendo dados atualizados da r√©plica local DC-South onde a escrita aconteceu."
        }
      },
      {
        "id": "dc-south",
        "type": "database",
        "label": "DC-South (Primary)",
        "status": "healthy",
        "position": { "x": 600, "y": 230 },
        "inspectable": true,
        "inspectData": {
          "title": "Data Center Sul ‚Äî Banco de Dados Prim√°rio",
          "logs": [
            "[16:20:00] INFO: Write: Reznikov status updated to 'Prime Suspect' (v4)",
            "[16:20:01] INFO: Queuing async replication to DC-North",
            "[16:30:00] WARN: Replication to DC-North delayed ‚Äî network congestion"
          ],
          "data": {
            "Status": "ONLINE",
            "Role": "Primary (accepts writes)",
            "Reznikov Record Version": "v4 (current)",
            "Pending Replications": "47 records",
            "Replication Mode": "Asynchronous"
          },
          "status": "Banco de dados prim√°rio com dados mais recentes. Replica√ß√£o ass√≠ncrona para DC-North est√° atrasada."
        }
      }
    ],
    "edges": [
      { "id": "e-north-dcn", "source": "north-precinct", "target": "dc-north", "label": "read (stale)", "animated": true, "style": "slow" },
      { "id": "e-south-dcs", "source": "south-precinct", "target": "dc-south", "label": "read/write", "animated": true, "style": "normal" },
      { "id": "e-dcs-dcn", "source": "dc-south", "target": "dc-north", "label": "async replication (lagging)", "animated": true, "style": "slow" }
    ]
  },
  "diagnosis": {
    "rootCause": {
      "question": "Por que as duas delegacias veem vers√µes diferentes do perfil do Reznikov?",
      "options": [
        {
          "id": "rc-1",
          "text": "Um hacker modificou o registro do Reznikov em um data center, mas esqueceu de alterar no outro",
          "correct": false,
          "feedback": "Os logs mostram uma atualiza√ß√£o leg√≠tima no DC-South que simplesmente ainda n√£o replicou para o DC-North. Isso √© um problema de consist√™ncia, n√£o uma viola√ß√£o de seguran√ßa."
        },
        {
          "id": "rc-2",
          "text": "O sistema usa replica√ß√£o ass√≠ncrona com consist√™ncia eventual, ent√£o o DC-North serve dados desatualizados at√© a replica√ß√£o se atualizar ‚Äî um cl√°ssico tradeoff do Teorema CAP",
          "correct": true,
          "feedback": "Correto! O sistema escolheu Disponibilidade e toler√¢ncia a Parti√ß√µes (AP) em vez de Consist√™ncia. Com replica√ß√£o ass√≠ncrona, ambos os data centers permanecem dispon√≠veis para leituras e escritas, mas podem servir vers√µes diferentes dos mesmos dados. Este √© o Teorema CAP em a√ß√£o: em um sistema distribu√≠do, n√£o √© poss√≠vel ter consist√™ncia perfeita, disponibilidade e toler√¢ncia a parti√ß√µes simultaneamente."
        },
        {
          "id": "rc-3",
          "text": "O banco de dados do DC-North corrompeu o registro do Reznikov durante a opera√ß√£o, e por isso n√£o consegue mostrar a atualiza√ß√£o mais recente. Devido a isso, a delegacia do norte n√£o consegue realizar a pris√£o do suspeito.",
          "correct": false,
          "feedback": "Os dados do DC-North n√£o est√£o corrompidos ‚Äî √© simplesmente uma vers√£o mais antiga (v3 vs v4). O registro estava correto quando foi escrito; apenas n√£o foi atualizado com a √∫ltima altera√ß√£o do DC-South."
        },
        {
          "id": "rc-4",
          "text": "As duas delegacias est√£o consultando tabelas diferentes que por acaso t√™m o mesmo nome de suspeito",
          "correct": false,
          "feedback": "Ambas as delegacias consultam o mesmo banco de dados l√≥gico, apenas r√©plicas f√≠sicas diferentes. S√£o os mesmos dados ‚Äî o problema √© o atraso de replica√ß√£o entre as duas c√≥pias."
        }
      ]
    },
    "fix": {
      "question": "Qual √© a melhor abordagem para prevenir inconsist√™ncias perigosas em dados cr√≠ticos de suspeitos?",
      "options": [
        {
          "id": "fix-1",
          "text": "Mudar para replica√ß√£o s√≠ncrona para absolutamente todos os dados para que os data centers sempre concordem",
          "correct": false,
          "feedback": "Replica√ß√£o s√≠ncrona para todos os dados adiciona lat√™ncia a cada escrita e reduz disponibilidade se qualquer DC estiver lento ou inacess√≠vel. Isso √© excessivo ‚Äî nem todos os dados s√£o igualmente cr√≠ticos."
        },
        {
          "id": "fix-2",
          "text": "Usar consist√™ncia forte (replica√ß√£o s√≠ncrona ou leituras por qu√≥rum) para campos cr√≠ticos como status do suspeito, mantendo consist√™ncia eventual para dados menos cr√≠ticos",
          "correct": true,
          "feedback": "Correto! Uma abordagem de consist√™ncia ajust√°vel permite exigir consist√™ncia forte para dados cr√≠ticos de seguran√ßa (status do suspeito, informa√ß√µes de mandados) enquanto permite consist√™ncia eventual para dados menos cr√≠ticos (notas do caso, estat√≠sticas). Isso equilibra o tradeoff CAP de forma inteligente ‚Äî voc√™ paga o custo de lat√™ncia da consist√™ncia apenas onde realmente importa."
        },
        {
          "id": "fix-3",
          "text": "Remover o DC-North completamente e fazer todas as delegacias lerem apenas do DC-South",
          "correct": false,
          "feedback": "Isso elimina o problema de consist√™ncia, mas tamb√©m elimina o benef√≠cio de disponibilidade de ter dois data centers. Se o DC-South cair, todos perdem acesso."
        },
        {
          "id": "fix-4",
          "text": "Adicionar um atraso de 15 minutos antes que oficiais possam agir com base nos resultados do banco de dados",
          "correct": false,
          "feedback": "Fazer oficiais esperarem derrota o prop√≥sito de ter um banco de dados. O atraso de replica√ß√£o √© o problema ‚Äî adicionar atrasos artificiais por cima n√£o resolve, apenas desacelera todo mundo igualmente."
        }
      ]
    }
  },
  "conceptId": "cap-theorem",
  "badge": {
    "name": "Navegador CAP",
    "icon": "üß≠"
  }
}